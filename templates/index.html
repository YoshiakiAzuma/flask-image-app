<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Image Gallery</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .gallery-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      cursor: pointer;
      border-radius: 8px;
    }
    .modal-img {
      max-height: 70vh;
      object-fit: contain;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container py-4">
    <h1 class="mb-4 text-center">Image Gallery</h1>

    <!-- アップロードフォーム -->
    <form class="mb-4 row g-2" method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data">
      <div class="col-md-4">
        <input type="file" class="form-control" name="file" required>
      </div>
      <div class="col-md-4">
        <input type="text" class="form-control" name="comment" placeholder="コメント">
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-primary w-100">アップロード</button>
      </div>
    </form>

    <!-- ギャラリー -->
    <div class="row g-3">
      {% for image in images %}
      <div class="col-6 col-md-3">
        <div class="card gallery-card shadow-sm">
          <img src="{{ url_for('uploaded_file', filename=image[1]) }}"
               alt="{{ image[2] }}"
               class="card-img-top"
               data-bs-target="#imageCarousel"
               data-bs-slide-to="{{ loop.index0 }}"
               data-bs-toggle="modal">
          <div class="card-body p-2">
            <p class="card-text small">{{ image[2] }}</p>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- ページネーション -->
    <nav aria-label="Page navigation" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if page > 1 %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('index', page=page-1) }}">前のページ</a>
          </li>
        {% endif %}
        <li class="page-item active"><span class="page-link">Page {{ page }}</span></li>
        {% if has_next %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('index', page=page+1) }}">次のページ</a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>

  <!-- モーダル + カルーセル -->
  <div class="modal fade" id="imageCarousel" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content bg-dark text-white">
        <div class="modal-body p-0">
          <div id="carouselInner" class="carousel slide" data-bs-ride="false">
            <div class="carousel-inner">
              {% for image in images %}
              <div class="carousel-item {% if loop.first %}active{% endif %}">
                <div class="d-flex flex-column justify-content-center align-items-center" style="min-height:80vh;">
                  <img src="{{ url_for('uploaded_file', filename=image[1]) }}" class="modal-img mb-3" alt="{{ image[2] }}">
                  <p class="text-center small text-light mt-2 mb-0">{{ image[2] }}</p>
                </div>
              </div>
              {% endfor %}
            </div>
            <!-- 左右矢印 -->
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselInner" data-bs-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselInner" data-bs-slide="next">
              <span class="carousel-control-next-icon"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
